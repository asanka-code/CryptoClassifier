
# Reference: http://witestlab.poly.edu/~ffund/el9043/labs/lab1.html


# includes core parts of numpy, matplotlib
import matplotlib.pyplot as plt
import numpy as np

sampleRate=20000000

'''
# practice reading in complex values stored in a file
# Read in data that has been stored as raw I/Q interleaved 32-bit float samples
dat = np.fromfile("./data/with-aes.cfile", dtype="float32")
sampleRate=20000000

# Turn the interleaved I and Q samples into complex values
# the syntax "dat[0::2]" means "every 2nd value in 
# array dat starting from the 0th until the end"
dat = dat[0::2] + 1j*dat[1::2]

# Note: a quicker way to turn the interleaved I and Q samples  into complex values
# (courtesy of http://stackoverflow.com/a/5658446/) would be:
# dat = dat.astype(np.float32).view(np.complex64)
'''

#########################################################################

def getData(cfileName):
    data = np.fromfile(cfileName, dtype="float32")
    data = data[0::2] + 1j*data[1::2]
    return data

def getSegment(timeOffset):
    # Segment window (seconds)
    w = 0.08
    # Segment starting offset (sample points)
    start = timeOffset * sampleRate
    # Segment ending offset (sample points)
    end = start + (w * sampleRate)
    #print("start=%d", int(start))
    #print("end=%d", int(end))
    return int(start), int(end)


def plotSpectrogram(data, timeOffset, specFileName):
    start, end = getSegment(timeOffset)    
    plt.specgram(data[start:end], NFFT=4096, Fs=sampleRate, cmap=plt.cm.get_cmap("Greys"))
    #plt.xlabel("Time (s)")
    #plt.ylabel("Frequency (MHz)")
    plt.axis('off')
    ax = plt.axes()
    ax.xaxis.set_visible(False)
    ax.yaxis.set_visible(False)    
    plt.ylim(-2000000, 2000000)    
    plt.savefig('./spectrograms/' + specFileName +'.png', fotmat='png', bbox_inches='tight', pad_inches=0)
    #plt.savefig('spectrogram-from-iq.pdf', fotmat='pdf', bbox_inches='tight')
    return 1
    
#########################################################################

# 3DES regions
data = getData("./data/with-xor.cfile")
plotSpectrogram(data, 0.27, 'xor.1')
plotSpectrogram(data, 0.27, 'xor.2')
plotSpectrogram(data, 0.27, 'xor.3')
plotSpectrogram(data, 0.27, 'xor.4')
plotSpectrogram(data, 0.27, 'xor.5')
plotSpectrogram(data, 0.27, 'xor.6')
plotSpectrogram(data, 0.27, 'xor.7')
plotSpectrogram(data, 0.27, 'xor.8')
plotSpectrogram(data, 0.27, 'xor.9')
plotSpectrogram(data, 0.27, 'xor.10')

plotSpectrogram(data, 0.27, 'xor.11')
plotSpectrogram(data, 0.27, 'xor.12')
plotSpectrogram(data, 0.27, 'xor.13')
plotSpectrogram(data, 0.27, 'xor.14')
plotSpectrogram(data, 0.27, 'xor.15')
plotSpectrogram(data, 0.27, 'xor.16')
plotSpectrogram(data, 0.27, 'xor.17')
plotSpectrogram(data, 0.27, 'xor.18')
plotSpectrogram(data, 0.27, 'xor.19')
plotSpectrogram(data, 0.27, 'xor.20')

plotSpectrogram(data, 0.27, 'xor.21')
plotSpectrogram(data, 0.27, 'xor.22')
plotSpectrogram(data, 0.27, 'xor.23')
plotSpectrogram(data, 0.27, 'xor.24')
plotSpectrogram(data, 0.27, 'xor.25')
plotSpectrogram(data, 0.27, 'xor.26')
plotSpectrogram(data, 0.27, 'xor.27')
plotSpectrogram(data, 0.27, 'xor.28')
plotSpectrogram(data, 0.27, 'xor.29')
plotSpectrogram(data, 0.27, 'xor.20')

plotSpectrogram(data, 0.27, 'xor.31')
plotSpectrogram(data, 0.27, 'xor.32')
plotSpectrogram(data, 0.27, 'xor.33')
plotSpectrogram(data, 0.27, 'xor.34')
plotSpectrogram(data, 0.27, 'xor.35')
plotSpectrogram(data, 0.27, 'xor.36')
plotSpectrogram(data, 0.27, 'xor.37')
plotSpectrogram(data, 0.27, 'xor.38')
plotSpectrogram(data, 0.27, 'xor.39')
plotSpectrogram(data, 0.27, 'xor.40')

plotSpectrogram(data, 0.27, 'xor.41')
plotSpectrogram(data, 0.27, 'xor.42')
plotSpectrogram(data, 0.27, 'xor.43')
plotSpectrogram(data, 0.27, 'xor.44')
plotSpectrogram(data, 0.27, 'xor.45')
plotSpectrogram(data, 0.27, 'xor.46')
plotSpectrogram(data, 0.27, 'xor.47')
plotSpectrogram(data, 0.27, 'xor.48')
plotSpectrogram(data, 0.27, 'xor.49')
plotSpectrogram(data, 0.27, 'xor.50')

plotSpectrogram(data, 0.27, 'xor.51')
plotSpectrogram(data, 0.27, 'xor.52')
plotSpectrogram(data, 0.27, 'xor.53')
plotSpectrogram(data, 0.27, 'xor.54')
plotSpectrogram(data, 0.27, 'xor.55')
plotSpectrogram(data, 0.27, 'xor.56')
plotSpectrogram(data, 0.27, 'xor.57')
plotSpectrogram(data, 0.27, 'xor.58')
plotSpectrogram(data, 0.27, 'xor.59')
plotSpectrogram(data, 0.27, 'xor.60')

plotSpectrogram(data, 0.27, 'xor.61')
plotSpectrogram(data, 0.27, 'xor.62')
plotSpectrogram(data, 0.27, 'xor.63')
plotSpectrogram(data, 0.27, 'xor.64')
plotSpectrogram(data, 0.27, 'xor.65')
plotSpectrogram(data, 0.27, 'xor.66')
plotSpectrogram(data, 0.27, 'xor.67')
plotSpectrogram(data, 0.27, 'xor.68')
plotSpectrogram(data, 0.27, 'xor.69')
plotSpectrogram(data, 0.27, 'xor.70')

plotSpectrogram(data, 0.27, 'xor.71')
plotSpectrogram(data, 0.27, 'xor.72')
plotSpectrogram(data, 0.27, 'xor.73')
plotSpectrogram(data, 0.27, 'xor.74')
plotSpectrogram(data, 0.27, 'xor.75')
plotSpectrogram(data, 0.27, 'xor.76')
plotSpectrogram(data, 0.27, 'xor.77')
plotSpectrogram(data, 0.27, 'xor.78')
plotSpectrogram(data, 0.27, 'xor.79')
plotSpectrogram(data, 0.27, 'xor.80')

'''
# 3DES regions
data = getData("./data/with-3des.cfile")
plotSpectrogram(data, 3.26, '3des.1')
plotSpectrogram(data, 3.26, '3des.2')
plotSpectrogram(data, 3.26, '3des.3')
plotSpectrogram(data, 3.26, '3des.4')
plotSpectrogram(data, 3.26, '3des.5')
plotSpectrogram(data, 3.26, '3des.6')
plotSpectrogram(data, 3.26, '3des.7')
plotSpectrogram(data, 3.26, '3des.8')
plotSpectrogram(data, 3.26, '3des.9')
plotSpectrogram(data, 3.26, '3des.10')

plotSpectrogram(data, 3.26, '3des.11')
plotSpectrogram(data, 3.26, '3des.12')
plotSpectrogram(data, 3.26, '3des.13')
plotSpectrogram(data, 3.26, '3des.14')
plotSpectrogram(data, 3.26, '3des.15')
plotSpectrogram(data, 3.26, '3des.16')
plotSpectrogram(data, 3.26, '3des.17')
plotSpectrogram(data, 3.26, '3des.18')
plotSpectrogram(data, 3.26, '3des.19')
plotSpectrogram(data, 3.26, '3des.20')

plotSpectrogram(data, 3.26, '3des.21')
plotSpectrogram(data, 3.26, '3des.22')
plotSpectrogram(data, 3.26, '3des.23')
plotSpectrogram(data, 3.26, '3des.24')
plotSpectrogram(data, 3.26, '3des.25')
plotSpectrogram(data, 3.26, '3des.26')
plotSpectrogram(data, 3.26, '3des.27')
plotSpectrogram(data, 3.26, '3des.28')
plotSpectrogram(data, 3.26, '3des.29')
plotSpectrogram(data, 3.26, '3des.30')

plotSpectrogram(data, 3.26, '3des.31')
plotSpectrogram(data, 3.26, '3des.32')
plotSpectrogram(data, 3.26, '3des.33')
plotSpectrogram(data, 3.26, '3des.34')
plotSpectrogram(data, 3.26, '3des.35')
plotSpectrogram(data, 3.26, '3des.36')
plotSpectrogram(data, 3.26, '3des.37')
plotSpectrogram(data, 3.26, '3des.38')
plotSpectrogram(data, 3.26, '3des.39')
plotSpectrogram(data, 3.26, '3des.40')

plotSpectrogram(data, 3.26, '3des.41')
plotSpectrogram(data, 3.26, '3des.42')
plotSpectrogram(data, 3.26, '3des.43')
plotSpectrogram(data, 3.26, '3des.44')
plotSpectrogram(data, 3.26, '3des.45')
plotSpectrogram(data, 3.26, '3des.46')
plotSpectrogram(data, 3.26, '3des.47')
plotSpectrogram(data, 3.26, '3des.48')
plotSpectrogram(data, 3.26, '3des.49')
plotSpectrogram(data, 3.26, '3des.50')

plotSpectrogram(data, 3.26, '3des.51')
plotSpectrogram(data, 3.26, '3des.52')
plotSpectrogram(data, 3.26, '3des.53')
plotSpectrogram(data, 3.26, '3des.54')
plotSpectrogram(data, 3.26, '3des.55')
plotSpectrogram(data, 3.26, '3des.56')
plotSpectrogram(data, 3.26, '3des.57')
plotSpectrogram(data, 3.26, '3des.58')
plotSpectrogram(data, 3.26, '3des.59')
plotSpectrogram(data, 3.26, '3des.60')

plotSpectrogram(data, 3.26, '3des.61')
plotSpectrogram(data, 3.26, '3des.62')
plotSpectrogram(data, 3.26, '3des.63')
plotSpectrogram(data, 3.26, '3des.64')
plotSpectrogram(data, 3.26, '3des.65')
plotSpectrogram(data, 3.26, '3des.66')
plotSpectrogram(data, 3.26, '3des.67')
plotSpectrogram(data, 3.26, '3des.68')
plotSpectrogram(data, 3.26, '3des.69')
plotSpectrogram(data, 3.26, '3des.70')

plotSpectrogram(data, 3.26, '3des.71')
plotSpectrogram(data, 3.26, '3des.72')
plotSpectrogram(data, 3.26, '3des.73')
plotSpectrogram(data, 3.26, '3des.74')
plotSpectrogram(data, 3.26, '3des.75')
plotSpectrogram(data, 3.26, '3des.76')
plotSpectrogram(data, 3.26, '3des.77')
plotSpectrogram(data, 3.26, '3des.78')
plotSpectrogram(data, 3.26, '3des.79')
plotSpectrogram(data, 3.26, '3des.80')


# AES regions
data = getData("./data/with-aes.cfile")
plotSpectrogram(data, 0.76, 'aes.1')
plotSpectrogram(data, 0.76, 'aes.2')
plotSpectrogram(data, 0.76, 'aes.3')
plotSpectrogram(data, 0.76, 'aes.4')
plotSpectrogram(data, 0.76, 'aes.5')
plotSpectrogram(data, 0.76, 'aes.6')
plotSpectrogram(data, 0.76, 'aes.7')
plotSpectrogram(data, 0.76, 'aes.8')
plotSpectrogram(data, 0.76, 'aes.9')
plotSpectrogram(data, 0.76, 'aes.10')
plotSpectrogram(data, 0.76, 'aes.11')
plotSpectrogram(data, 0.76, 'aes.12')
plotSpectrogram(data, 0.76, 'aes.13')
plotSpectrogram(data, 0.76, 'aes.14')

plotSpectrogram(data, 0.76, 'aes.15')
plotSpectrogram(data, 0.76, 'aes.16')
plotSpectrogram(data, 0.76, 'aes.17')
plotSpectrogram(data, 0.76, 'aes.18')
plotSpectrogram(data, 0.76, 'aes.19')
plotSpectrogram(data, 0.76, 'aes.20')
plotSpectrogram(data, 0.76, 'aes.21')
plotSpectrogram(data, 0.76, 'aes.22')
plotSpectrogram(data, 0.76, 'aes.23')
plotSpectrogram(data, 0.76, 'aes.24')
plotSpectrogram(data, 0.76, 'aes.25')
plotSpectrogram(data, 0.76, 'aes.26')
plotSpectrogram(data, 0.76, 'aes.27')
plotSpectrogram(data, 0.76, 'aes.28')

plotSpectrogram(data, 0.76, 'aes.29')
plotSpectrogram(data, 0.76, 'aes.30')
plotSpectrogram(data, 0.76, 'aes.31')
plotSpectrogram(data, 0.76, 'aes.32')
plotSpectrogram(data, 0.76, 'aes.33')
plotSpectrogram(data, 0.76, 'aes.34')
plotSpectrogram(data, 0.76, 'aes.35')
plotSpectrogram(data, 0.76, 'aes.36')
plotSpectrogram(data, 0.76, 'aes.37')
plotSpectrogram(data, 0.76, 'aes.38')
plotSpectrogram(data, 0.76, 'aes.39')
plotSpectrogram(data, 0.76, 'aes.40')
plotSpectrogram(data, 0.76, 'aes.41')
plotSpectrogram(data, 0.76, 'aes.42')

plotSpectrogram(data, 0.76, 'aes.43')
plotSpectrogram(data, 0.76, 'aes.44')
plotSpectrogram(data, 0.76, 'aes.45')
plotSpectrogram(data, 0.76, 'aes.46')
plotSpectrogram(data, 0.76, 'aes.47')
plotSpectrogram(data, 0.76, 'aes.48')
plotSpectrogram(data, 0.76, 'aes.49')
plotSpectrogram(data, 0.76, 'aes.50')
plotSpectrogram(data, 0.76, 'aes.51')
plotSpectrogram(data, 0.76, 'aes.52')
plotSpectrogram(data, 0.76, 'aes.53')
plotSpectrogram(data, 0.76, 'aes.54')
plotSpectrogram(data, 0.76, 'aes.55')
plotSpectrogram(data, 0.76, 'aes.56')

plotSpectrogram(data, 0.76, 'aes.57')
plotSpectrogram(data, 0.76, 'aes.58')
plotSpectrogram(data, 0.76, 'aes.59')
plotSpectrogram(data, 0.76, 'aes.60')
plotSpectrogram(data, 0.76, 'aes.61')
plotSpectrogram(data, 0.76, 'aes.62')
plotSpectrogram(data, 0.76, 'aes.63')
plotSpectrogram(data, 0.76, 'aes.64')
plotSpectrogram(data, 0.76, 'aes.65')
plotSpectrogram(data, 0.76, 'aes.66')
plotSpectrogram(data, 0.76, 'aes.67')
plotSpectrogram(data, 0.76, 'aes.68')
plotSpectrogram(data, 0.76, 'aes.69')
plotSpectrogram(data, 0.76, 'aes.70')

plotSpectrogram(data, 0.76, 'aes.71')
plotSpectrogram(data, 0.76, 'aes.72')
plotSpectrogram(data, 0.76, 'aes.73')
plotSpectrogram(data, 0.76, 'aes.74')
plotSpectrogram(data, 0.76, 'aes.75')
plotSpectrogram(data, 0.76, 'aes.76')
plotSpectrogram(data, 0.76, 'aes.77')
plotSpectrogram(data, 0.76, 'aes.78')
plotSpectrogram(data, 0.76, 'aes.79')
plotSpectrogram(data, 0.76, 'aes.80')
plotSpectrogram(data, 0.76, 'aes.81')
plotSpectrogram(data, 0.76, 'aes.82')
plotSpectrogram(data, 0.76, 'aes.83')
plotSpectrogram(data, 0.76, 'aes.84')


data = getData("./data/with-aes.cfile")
plotSpectrogram(data, 0.95, 'none.1')
plotSpectrogram(data, 0.95, 'none.2')
plotSpectrogram(data, 0.95, 'none.3')
plotSpectrogram(data, 0.95, 'none.4')
plotSpectrogram(data, 0.95, 'none.5')
plotSpectrogram(data, 0.95, 'none.6')
plotSpectrogram(data, 0.95, 'none.7')
plotSpectrogram(data, 0.95, 'none.8')
plotSpectrogram(data, 0.95, 'none.9')
plotSpectrogram(data, 0.95, 'none.10')

plotSpectrogram(data, 0.95, 'none.11')
plotSpectrogram(data, 0.95, 'none.12')
plotSpectrogram(data, 0.95, 'none.13')
plotSpectrogram(data, 0.95, 'none.14')
plotSpectrogram(data, 0.95, 'none.15')
plotSpectrogram(data, 0.95, 'none.16')
plotSpectrogram(data, 0.95, 'none.17')
plotSpectrogram(data, 0.95, 'none.18')
plotSpectrogram(data, 0.95, 'none.19')
plotSpectrogram(data, 0.95, 'none.20')

plotSpectrogram(data, 0.95, 'none.21')
plotSpectrogram(data, 0.95, 'none.22')
plotSpectrogram(data, 0.95, 'none.23')
plotSpectrogram(data, 0.95, 'none.24')
plotSpectrogram(data, 0.95, 'none.25')
plotSpectrogram(data, 0.95, 'none.26')
plotSpectrogram(data, 0.95, 'none.27')
plotSpectrogram(data, 0.95, 'none.28')
plotSpectrogram(data, 0.95, 'none.29')
plotSpectrogram(data, 0.95, 'none.30')

plotSpectrogram(data, 0.95, 'none.31')
plotSpectrogram(data, 0.95, 'none.32')
plotSpectrogram(data, 0.95, 'none.33')
plotSpectrogram(data, 0.95, 'none.34')
plotSpectrogram(data, 0.95, 'none.35')
plotSpectrogram(data, 0.95, 'none.36')
plotSpectrogram(data, 0.95, 'none.37')
plotSpectrogram(data, 0.95, 'none.38')
plotSpectrogram(data, 0.95, 'none.39')
plotSpectrogram(data, 0.95, 'none.40')

plotSpectrogram(data, 0.95, 'none.41')
plotSpectrogram(data, 0.95, 'none.42')
plotSpectrogram(data, 0.95, 'none.43')
plotSpectrogram(data, 0.95, 'none.44')
plotSpectrogram(data, 0.95, 'none.45')
plotSpectrogram(data, 0.95, 'none.46')
plotSpectrogram(data, 0.95, 'none.47')
plotSpectrogram(data, 0.95, 'none.48')
plotSpectrogram(data, 0.95, 'none.49')
plotSpectrogram(data, 0.95, 'none.50')

plotSpectrogram(data, 0.95, 'none.51')
plotSpectrogram(data, 0.95, 'none.52')
plotSpectrogram(data, 0.95, 'none.53')
plotSpectrogram(data, 0.95, 'none.54')
plotSpectrogram(data, 0.95, 'none.55')
plotSpectrogram(data, 0.95, 'none.56')
plotSpectrogram(data, 0.95, 'none.57')
plotSpectrogram(data, 0.95, 'none.58')
plotSpectrogram(data, 0.95, 'none.59')
plotSpectrogram(data, 0.95, 'none.60')

plotSpectrogram(data, 0.95, 'none.61')
plotSpectrogram(data, 0.95, 'none.62')
plotSpectrogram(data, 0.95, 'none.63')
plotSpectrogram(data, 0.95, 'none.64')
plotSpectrogram(data, 0.95, 'none.65')
plotSpectrogram(data, 0.95, 'none.66')
plotSpectrogram(data, 0.95, 'none.67')
plotSpectrogram(data, 0.95, 'none.68')
plotSpectrogram(data, 0.95, 'none.69')
plotSpectrogram(data, 0.95, 'none.70')

plotSpectrogram(data, 0.95, 'none.71')
plotSpectrogram(data, 0.95, 'none.72')
plotSpectrogram(data, 0.95, 'none.73')
plotSpectrogram(data, 0.95, 'none.74')
plotSpectrogram(data, 0.95, 'none.75')
plotSpectrogram(data, 0.95, 'none.76')
plotSpectrogram(data, 0.95, 'none.77')
plotSpectrogram(data, 0.95, 'none.78')
plotSpectrogram(data, 0.95, 'none.79')
plotSpectrogram(data, 0.95, 'none.80')
'''